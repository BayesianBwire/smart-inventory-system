{% extends "base.html" %}

{% block title %}{{ _('Register Company') }} - RahaSoft ERP{% endblock %}

{% block content %}
<div class="container-fluid py-5" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh;">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-lg-8 col-xl-7">
        <div class="card border-0 shadow-2xl" style="border-radius: 20px; overflow: hidden;">
          <!-- Header -->
          <div class="card-header text-white text-center py-5" style="background: linear-gradient(135deg, #004d7a 0%, #008793 100%);">
            <div class="mb-3">
              <i class="fas fa-building fa-4x"></i>
            </div>
            <h1 class="h2 mb-2 fw-bold">{{ _('Register Your Company') }}</h1>
            <p class="mb-0 opacity-75">{{ _('Create your business profile and start managing your operations') }}</p>
          </div>
          
          <!-- Body -->
          <div class="card-body p-5">
            <!-- Info Alert -->
            <div class="alert alert-info border-0 mb-4" style="background: rgba(59, 130, 246, 0.1); border-radius: 12px;">
              <div class="d-flex align-items-center">
                <i class="fas fa-info-circle me-3 text-info"></i>
                <div>
                  <strong>{{ _('Create Your Business Account') }}</strong><br>
                  <small>{{ _('This will register your company AND create your founder account. You will be automatically logged in after registration.') }}</small>
                </div>
              </div>
            </div>

            <form method="POST" novalidate class="needs-validation">
              {{ form.hidden_tag() }}
              
              <!-- Company Information Section -->
              <div class="mb-5">
                <h4 class="text-primary mb-4 fw-semibold">
                  <i class="fas fa-building me-2"></i>{{ _('Company Information') }}
                </h4>
                
                <div class="row g-3">
                  <!-- Company Name -->
                  <div class="col-12">
                    <label for="{{ form.name.id }}" class="form-label fw-semibold">
                      {{ _('Company Name') }} <span class="text-danger">*</span>
                    </label>
                    {{ form.name(class="form-control form-control-lg", placeholder=_('Enter your company name'), required=true) }}
                    {% if form.name.errors %}
                      <div class="invalid-feedback d-block">
                        {% for error in form.name.errors %}
                          {{ error }}
                        {% endfor %}
                      </div>
                    {% endif %}
                  </div>

                  <!-- Industry -->
                  <div class="col-md-6">
                    <label for="{{ form.industry.id }}" class="form-label fw-semibold">
                      {{ _('Industry') }}
                    </label>
                    {{ form.industry(class="form-select form-select-lg") }}
                    {% if form.industry.errors %}
                      <div class="invalid-feedback d-block">
                        {% for error in form.industry.errors %}
                          {{ error }}
                        {% endfor %}
                      </div>
                    {% endif %}
                  </div>

                  <!-- Company Email -->
                  <div class="col-md-6">
                    <label for="{{ form.email.id }}" class="form-label fw-semibold">
                      {{ _('Company Email') }} <span class="text-danger">*</span>
                    </label>
                    {{ form.email(class="form-control form-control-lg", placeholder=_('company@example.com'), type="email", required=true) }}
                    {% if form.email.errors %}
                      <div class="invalid-feedback d-block">
                        {% for error in form.email.errors %}
                          {{ error }}
                        {% endfor %}
                      </div>
                    {% endif %}
                  </div>

                  <!-- Phone -->
                  <div class="col-md-6">
                    <label for="{{ form.phone.id }}" class="form-label fw-semibold">
                      {{ _('Phone Number') }}
                    </label>
                    {{ form.phone(class="form-control form-control-lg", placeholder=_('(254) 123-456-789')) }}
                    {% if form.phone.errors %}
                      <div class="invalid-feedback d-block">
                        {% for error in form.phone.errors %}
                          {{ error }}
                        {% endfor %}
                      </div>
                    {% endif %}
                  </div>

                  <!-- Website -->
                  <div class="col-md-6">
                    <label for="{{ form.website.id }}" class="form-label fw-semibold">
                      {{ _('Website') }}
                    </label>
                    {{ form.website(class="form-control form-control-lg", placeholder=_('https://www.yourcompany.com')) }}
                    {% if form.website.errors %}
                      <div class="invalid-feedback d-block">
                        {% for error in form.website.errors %}
                          {{ error }}
                        {% endfor %}
                      </div>
                    {% endif %}
                  </div>

                  <!-- Address -->
                  <div class="col-12">
                    <label for="{{ form.address.id }}" class="form-label fw-semibold">
                      {{ _('Street Address') }}
                    </label>
                    {{ form.address(class="form-control", rows="2", placeholder=_('Enter your company address')) }}
                    {% if form.address.errors %}
                      <div class="invalid-feedback d-block">
                        {% for error in form.address.errors %}
                          {{ error }}
                        {% endfor %}
                      </div>
                    {% endif %}
                  </div>

                  <!-- City, State, Country -->
                  <div class="col-md-4">
                    <label for="{{ form.city.id }}" class="form-label fw-semibold">
                      {{ _('City') }}
                    </label>
                    {{ form.city(class="form-control", placeholder=_('City')) }}
                    {% if form.city.errors %}
                      <div class="invalid-feedback d-block">
                        {% for error in form.city.errors %}
                          {{ error }}
                        {% endfor %}
                      </div>
                    {% endif %}
                  </div>

                  <div class="col-md-4">
                    <label for="{{ form.state.id }}" class="form-label fw-semibold">
                      {{ _('State/Province') }}
                    </label>
                    {{ form.state(class="form-control", placeholder=_('State')) }}
                    {% if form.state.errors %}
                      <div class="invalid-feedback d-block">
                        {% for error in form.state.errors %}
                          {{ error }}
                        {% endfor %}
                      </div>
                    {% endif %}
                  </div>

                  <div class="col-md-4">
                    <label for="{{ form.country.id }}" class="form-label fw-semibold">
                      {{ _('Country') }}
                    </label>
                    {{ form.country(class="form-control", placeholder=_('Country')) }}
                    {% if form.country.errors %}
                      <div class="invalid-feedback d-block">
                        {% for error in form.country.errors %}
                          {{ error }}
                        {% endfor %}
                      </div>
                    {% endif %}
                  </div>

                  <!-- Postal Code -->
                  <div class="col-md-4">
                    <label for="{{ form.postal_code.id }}" class="form-label fw-semibold">
                      {{ _('Postal Code') }}
                    </label>
                    {{ form.postal_code(class="form-control", placeholder=_('12345')) }}
                    {% if form.postal_code.errors %}
                      <div class="invalid-feedback d-block">
                        {% for error in form.postal_code.errors %}
                          {{ error }}
                        {% endfor %}
                      </div>
                    {% endif %}
                  </div>

                  <!-- Description -->
                  <div class="col-12">
                    <label for="{{ form.description.id }}" class="form-label fw-semibold">
                      {{ _('Company Description') }}
                    </label>
                    {{ form.description(class="form-control", rows="3", placeholder=_('Briefly describe your company and its services...')) }}
                    {% if form.description.errors %}
                      <div class="invalid-feedback d-block">
                        {% for error in form.description.errors %}
                          {{ error }}
                        {% endfor %}
                      </div>
                    {% endif %}
                  </div>
                </div>
              </div>

              <!-- Founder Information Section -->
              <div class="mb-5">
                <h4 class="text-primary mb-4 fw-semibold">
                  <i class="fas fa-user-crown me-2"></i>{{ _('Founder Information') }}
                </h4>
                
                <div class="row g-3">
                  <!-- Founder Name -->
                  <div class="col-md-6">
                    <label for="{{ form.founder_name.id }}" class="form-label fw-semibold">
                      {{ _('Full Name') }} <span class="text-danger">*</span>
                    </label>
                    {{ form.founder_name(class="form-control form-control-lg", placeholder=_('Your full name'), required=true) }}
                    {% if form.founder_name.errors %}
                      <div class="invalid-feedback d-block">
                        {% for error in form.founder_name.errors %}
                          {{ error }}
                        {% endfor %}
                      </div>
                    {% endif %}
                  </div>

                  <!-- Founder Username -->
                  <div class="col-md-6">
                    <label for="{{ form.founder_username.id }}" class="form-label fw-semibold">
                      {{ _('Username') }} <span class="text-danger">*</span>
                    </label>
                    {{ form.founder_username(class="form-control form-control-lg", placeholder=_('Choose a username'), required=true) }}
                    {% if form.founder_username.errors %}
                      <div class="invalid-feedback d-block">
                        {% for error in form.founder_username.errors %}
                          {{ error }}
                        {% endfor %}
                      </div>
                    {% endif %}
                  </div>

                  <!-- Founder Email -->
                  <div class="col-12">
                    <label for="{{ form.founder_email.id }}" class="form-label fw-semibold">
                      {{ _('Email Address') }} <span class="text-danger">*</span>
                    </label>
                    {{ form.founder_email(class="form-control form-control-lg", placeholder=_('your.email@example.com'), type="email", required=true) }}
                    {% if form.founder_email.errors %}
                      <div class="invalid-feedback d-block">
                        {% for error in form.founder_email.errors %}
                          {{ error }}
                        {% endfor %}
                      </div>
                    {% endif %}
                  </div>

                  <!-- Founder Password -->
                  <div class="col-md-6">
                    <label for="{{ form.founder_password.id }}" class="form-label fw-semibold">
                      {{ _('Password') }} <span class="text-danger">*</span>
                    </label>
                    {{ form.founder_password(class="form-control form-control-lg", placeholder=_('Choose a strong password'), required=true) }}
                    {% if form.founder_password.errors %}
                      <div class="invalid-feedback d-block">
                        {% for error in form.founder_password.errors %}
                          {{ error }}
                        {% endfor %}
                      </div>
                    {% endif %}
                  </div>

                  <!-- Confirm Password -->
                  <div class="col-md-6">
                    <label for="{{ form.confirm_password.id }}" class="form-label fw-semibold">
                      {{ _('Confirm Password') }} <span class="text-danger">*</span>
                    </label>
                    {{ form.confirm_password(class="form-control form-control-lg", placeholder=_('Confirm your password'), required=true) }}
                    {% if form.confirm_password.errors %}
                      <div class="invalid-feedback d-block">
                        {% for error in form.confirm_password.errors %}
                          {{ error }}
                        {% endfor %}
                      </div>
                    {% endif %}
                  </div>
                </div>
              </div>

              <!-- Terms and Submit -->
              <div class="mb-4">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="terms" required>
                  <label class="form-check-label" for="terms">
                    {{ _('I agree to the') }} <a href="{{ url_for('terms') }}" target="_blank" class="text-decoration-none">{{ _('Terms of Service') }}</a> 
                    {{ _('and') }} <a href="{{ url_for('privacy') }}" target="_blank" class="text-decoration-none">{{ _('Privacy Policy') }}</a>
                  </label>
                </div>
              </div>

              <!-- Submit Button -->
              <div class="d-grid gap-3">
                {{ form.submit(class="btn btn-primary btn-lg py-3 fw-semibold", style="border-radius: 12px; font-size: 1.1rem;") }}
                <div class="text-center">
                  <a href="{{ url_for('welcome') }}" class="btn btn-outline-secondary btn-lg px-4" style="border-radius: 12px;">
                    <i class="fas fa-arrow-left me-2"></i>{{ _('Back to Welcome') }}
                  </a>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
:root {
  --primary-color: #004d7a;
  --secondary-color: #008793;
  --gradient-primary: linear-gradient(135deg, #004d7a 0%, #008793 100%);
  --shadow-lg: 0 15px 35px rgba(0, 0, 0, 0.1);
  --shadow-2xl: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
}

.card {
  transition: all 0.3s ease;
}

.form-control:focus,
.form-select:focus {
  border-color: var(--primary-color);
  box-shadow: 0 0 0 0.25rem rgba(0, 77, 122, 0.15);
  transform: translateY(-1px);
}

.btn-primary {
  background: var(--gradient-primary);
  border: none;
  transition: all 0.3s ease;
  letter-spacing: 0.5px;
}

.btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-lg);
  background: linear-gradient(135deg, #003a5f 0%, #006b7a 100%);
}

.btn-outline-secondary {
  border: 2px solid #6c757d;
  color: #6c757d;
  transition: all 0.3s ease;
}

.btn-outline-secondary:hover {
  background: #6c757d;
  color: white;
  transform: translateY(-1px);
}

.form-control,
.form-select {
  border: 2px solid #e9ecef;
  border-radius: 8px;
  transition: all 0.3s ease;
  font-size: 1rem;
}

.form-control-lg,
.form-select-lg {
  padding: 12px 16px;
  font-size: 1.1rem;
}

.invalid-feedback {
  display: block !important;
  color: #dc3545;
  font-size: 0.875rem;
  margin-top: 0.25rem;
}

.text-primary {
  color: var(--primary-color) !important;
}

.alert-info {
  background: rgba(59, 130, 246, 0.1);
  border: 1px solid rgba(59, 130, 246, 0.2);
  color: #1e40af;
}

.form-check-input:checked {
  background-color: var(--primary-color);
  border-color: var(--primary-color);
}

@media (max-width: 768px) {
  .card-body {
    padding: 2rem !important;
  }
  
  .container-fluid {
    padding: 2rem 0;
  }
  
  .form-control-lg,
  .form-select-lg {
    font-size: 1rem;
    padding: 10px 14px;
  }
}

@media (max-width: 576px) {
  .card-header {
    padding: 2rem 1rem !important;
  }
  
  .card-header .fa-4x {
    font-size: 2.5rem !important;
  }
  
  .card-header h1 {
    font-size: 1.5rem !important;
  }
}
</style>

<script>
// Form validation and enhancement
document.addEventListener('DOMContentLoaded', function() {
  const form = document.querySelector('.needs-validation');
  const inputs = form.querySelectorAll('input, select, textarea');
  
  // Real-time validation
  inputs.forEach(input => {
    input.addEventListener('blur', function() {
      validateField(this);
    });
    
    input.addEventListener('input', function() {
      if (this.classList.contains('is-invalid')) {
        validateField(this);
      }
    });
  });
  
  // Form submission validation
  form.addEventListener('submit', function(event) {
    let isValid = true;
    
    inputs.forEach(input => {
      if (!validateField(input)) {
        isValid = false;
      }
    });
    
    if (!isValid) {
      event.preventDefault();
      event.stopPropagation();
      
      // Scroll to first error
      const firstError = form.querySelector('.is-invalid');
      if (firstError) {
        firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
        firstError.focus();
      }
    }
  });
  
  function validateField(field) {
    const value = field.value.trim();
    const isRequired = field.hasAttribute('required');
    let isValid = true;
    
    // Remove previous validation classes
    field.classList.remove('is-valid', 'is-invalid');
    
    // Required field validation
    if (isRequired && !value) {
      field.classList.add('is-invalid');
      isValid = false;
    }
    
    // Email validation
    if (field.type === 'email' && value) {
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(value)) {
        field.classList.add('is-invalid');
        isValid = false;
      }
    }
    
    // Password confirmation
    if (field.id === 'confirm_password') {
      const password = document.getElementById('founder_password');
      if (password && value !== password.value) {
        field.classList.add('is-invalid');
        isValid = false;
      }
    }
    
    // If valid and has value, mark as valid
    if (isValid && value) {
      field.classList.add('is-valid');
    }
    
    return isValid;
  }
  
  // Password confirmation real-time check
  const password = document.getElementById('founder_password');
  const confirmPassword = document.getElementById('confirm_password');
  
  if (password && confirmPassword) {
    [password, confirmPassword].forEach(field => {
      field.addEventListener('input', function() {
        if (confirmPassword.value) {
          validateField(confirmPassword);
        }
      });
    });
  }
});
</script>
{% endblock %}
