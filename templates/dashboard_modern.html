{% extends "base.html" %}
{% block content %}

<style>
  /* Dark theme support for dashboard */
  [data-theme="dark"] .dashboard-container {
    background: var(--bg-secondary);
  }

  [data-theme="dark"] .sidebar {
    background: var(--bg-primary);
    border-color: var(--border-color);
  }

  [data-theme="dark"] .main-content {
    background: var(--bg-primary);
    color: var(--text-primary);
  }

  [data-theme="dark"] .feature-card {
    background: var(--bg-secondary);
    border-color: var(--border-color);
    color: var(--text-primary);
  }

  [data-theme="dark"] .feature-title {
    color: var(--text-primary);
  }

  [data-theme="dark"] .content-title {
    color: var(--text-primary);
  }

  :root {
    --primary-color: #3b82f6;
    --secondary-color: #1e40af;
    --accent-color: #fbbf24;
    --dark-color: #1f2937;
    --light-color: #f8fafc;
    --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    --gradient-secondary: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
    --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
  }

  .dashboard-container {
    display: flex;
    min-height: calc(100vh - 80px);
    background: linear-gradient(to bottom, #f8fafc, white);
  }

  /* Sidebar Styles */
  .sidebar {
    width: 300px;
    background: white;
    border-right: 1px solid #e5e7eb;
    padding: 2rem 0;
    position: sticky;
    top: 80px;
    height: calc(100vh - 80px);
    overflow-y: auto;
    box-shadow: var(--shadow-sm);
  }

  .sidebar-header {
    padding: 0 1.5rem 1.5rem;
    border-bottom: 1px solid #e5e7eb;
    margin-bottom: 1.5rem;
  }

  .sidebar-title {
    font-family: 'Playfair Display', serif;
    font-size: 1.5rem;
    font-weight: 700;
    background: var(--gradient-primary);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 0.5rem;
  }

  .sidebar-subtitle {
    color: #6b7280;
    font-size: 0.875rem;
  }

  .module-item {
    padding: 0.75rem 1.5rem;
    cursor: pointer;
    transition: all 0.3s ease;
    border-left: 3px solid transparent;
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .module-item:hover {
    background: linear-gradient(to right, rgba(59, 130, 246, 0.05), transparent);
    border-left-color: var(--primary-color);
  }

  .module-item.active {
    background: linear-gradient(to right, rgba(59, 130, 246, 0.1), transparent);
    border-left-color: var(--primary-color);
    color: var(--primary-color);
  }

  .module-icon {
    width: 40px;
    height: 40px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2rem;
    color: white;
    flex-shrink: 0;
  }

  .module-info h6 {
    margin: 0;
    font-weight: 600;
    font-size: 0.875rem;
  }

  .module-info p {
    margin: 0;
    font-size: 0.75rem;
    color: #6b7280;
  }

  /* Main Content Styles */
  .main-content {
    flex: 1;
    padding: 2rem;
    background: white;
    margin: 1rem;
    border-radius: 20px;
    box-shadow: var(--shadow-md);
  }

  .content-header {
    margin-bottom: 2rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid #e5e7eb;
  }

  .content-title {
    font-family: 'Playfair Display', serif;
    font-size: 2rem;
    font-weight: 700;
    color: var(--dark-color);
    margin-bottom: 0.5rem;
  }

  .content-subtitle {
    color: #6b7280;
    font-size: 1rem;
  }

  .module-content {
    display: none;
  }

  .module-content.active {
    display: block;
    animation: fadeInUp 0.5s ease;
  }

  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Module Cards */
  .module-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
    margin-top: 2rem;
  }

  .feature-card {
    background: white;
    border-radius: 15px;
    padding: 2rem;
    box-shadow: var(--shadow-md);
    transition: all 0.3s ease;
    border: 1px solid #f1f5f9;
    text-align: center;
  }

  .feature-card:hover {
    transform: translateY(-5px);
    box-shadow: var(--shadow-lg);
    border-color: var(--primary-color);
  }

  .feature-icon {
    width: 60px;
    height: 60px;
    border-radius: 15px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    color: white;
    margin: 0 auto 1rem;
  }

  /* Color variations */
  .icon-blue { background: linear-gradient(135deg, #3b82f6, #1d4ed8); }
  .icon-green { background: linear-gradient(135deg, #10b981, #059669); }
  .icon-purple { background: linear-gradient(135deg, #8b5cf6, #7c3aed); }
  .icon-orange { background: linear-gradient(135deg, #f59e0b, #d97706); }
  .icon-red { background: linear-gradient(135deg, #ef4444, #dc2626); }
  .icon-indigo { background: linear-gradient(135deg, #6366f1, #4f46e5); }
  .icon-pink { background: linear-gradient(135deg, #ec4899, #be185d); }
  .icon-teal { background: linear-gradient(135deg, #14b8a6, #0f766e); }

  .feature-title {
    font-size: 1.1rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: var(--dark-color);
  }

  .feature-description {
    color: #6b7280;
    font-size: 0.875rem;
    margin-bottom: 1rem;
  }

  .feature-button {
    background: var(--gradient-primary);
    border: none;
    border-radius: 25px;
    padding: 0.5rem 1.5rem;
    font-weight: 600;
    color: white;
    text-decoration: none;
    transition: all 0.3s ease;
    display: inline-block;
    font-size: 0.875rem;
  }

  .feature-button:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
    color: white;
  }

  /* Welcome Section */
  .welcome-section {
    background: var(--gradient-primary);
    border-radius: 20px;
    padding: 2rem;
    color: white;
    margin-bottom: 2rem;
    text-align: center;
  }

  .welcome-title {
    font-family: 'Playfair Display', serif;
    font-size: 2.5rem;
    font-weight: 800;
    margin-bottom: 1rem;
  }

  .welcome-subtitle {
    font-size: 1.2rem;
    opacity: 0.9;
    margin-bottom: 2rem;
  }

  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 1rem;
    margin-top: 2rem;
  }

  .stat-card {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 15px;
    padding: 1.5rem;
    text-align: center;
  }

  .stat-number {
    font-size: 2rem;
    font-weight: 800;
    color: white;
    display: block;
  }

  .stat-label {
    color: rgba(255, 255, 255, 0.8);
    font-size: 0.875rem;
    margin-top: 0.5rem;
  }

  /* Responsive Design */
  @media (max-width: 768px) {
    .dashboard-container {
      flex-direction: column;
    }
    
    .sidebar {
      width: 100%;
      height: auto;
      position: relative;
      top: 0;
    }
    
    .main-content {
      margin: 0.5rem;
    }

    .welcome-title {
      font-size: 2rem;
    }
  }

  /* Company Modal Styling */
  .modal-backdrop-custom {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    z-index: 1040;
    -webkit-backdrop-filter: blur(3px);
    backdrop-filter: blur(3px);
  }

  .modal-backdrop-custom.show {
    display: block;
  }

  .modal-show {
    display: block !important;
    opacity: 1 !important;
  }

  .company-modal {
    z-index: 1050;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: block;
  }

  .company-modal .modal-content {
    animation: modalSlideIn 0.3s ease-out;
    border-radius: 10px;
    border: none;
    box-shadow: 0 10px 50px rgba(0, 0, 0, 0.3);
  }

  @keyframes modalSlideIn {
    from {
      opacity: 0;
      transform: scale(0.8) translateY(-50px);
    }
    to {
      opacity: 1;
      transform: scale(1) translateY(0);
    }
  }

  /* Dark theme modal adjustments */
  [data-theme="dark"] .modal-content {
    background-color: var(--bg-secondary);
    color: var(--text-primary);
    border: 1px solid var(--border-color);
  }

  [data-theme="dark"] .modal-header {
    border-color: var(--border-color);
  }

  [data-theme="dark"] .form-control,
  [data-theme="dark"] .form-select {
    background-color: var(--bg-primary);
    border-color: var(--border-color);
    color: var(--text-primary);
  }

  [data-theme="dark"] .form-control:focus,
  [data-theme="dark"] .form-select:focus {
    background-color: var(--bg-primary);
    border-color: var(--primary-color);
    color: var(--text-primary);
    box-shadow: 0 0 0 0.2rem rgba(59, 130, 246, 0.25);
  }

  [data-theme="dark"] .alert-info {
    background-color: rgba(59, 130, 246, 0.1);
    border-color: var(--primary-color);
    color: var(--primary-color);
  }

  /* Company Info Styling */
  .company-info {
    border: 1px solid #e3f2fd;
    background: linear-gradient(135deg, #f8f9ff 0%, #e3f2fd 100%);
  }

  [data-theme="dark"] .company-info {
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
    border-color: var(--border-color);
    color: var(--text-primary);
  }

  [data-theme="dark"] .company-info .text-muted {
    color: #b0bec5 !important;
  }

  .company-info .badge {
    font-size: 0.75rem;
    letter-spacing: 0.5px;
  }
</style>

<div class="dashboard-container">
  <!-- Sidebar -->
  <div class="sidebar">
    <div class="sidebar-header">
      <h2 class="sidebar-title">RahaSoft Suite</h2>
      <p class="sidebar-subtitle">Smart Business Management</p>
      {% if current_company %}
      <div class="company-info mt-3 p-2 bg-light rounded">
        <div class="d-flex align-items-center">
          <i class="fas fa-building text-primary me-2"></i>
          <div>
            <strong class="d-block">{{ current_company.name }}</strong>
            <small class="text-muted">ID: <span class="badge bg-primary">{{ current_company.unique_id }}</span></small>
          </div>
        </div>
      </div>
      {% endif %}
    </div>

    <div class="module-item active" data-module="welcome">
      <div class="module-icon icon-blue">
        <i class="fas fa-home"></i>
      </div>
      <div class="module-info">
        <h6>{{ _('Dashboard Home') }}</h6>
        <p>{{ _('Overview & Stats') }}</p>
      </div>
    </div>

    <div class="module-item" data-module="core-operations">
      <div class="module-icon icon-blue">
        <i class="fas fa-boxes"></i>
      </div>
      <div class="module-info">
        <h6>{{ _('Core Operations') }}</h6>
        <p>{{ _('Stock, POS, Procurement') }}</p>
      </div>
    </div>

    <div class="module-item" data-module="sales-marketing">
      <div class="module-icon icon-green">
        <i class="fas fa-chart-line"></i>
      </div>
      <div class="module-info">
        <h6>{{ _('Sales & Marketing') }}</h6>
        <p>{{ _('Analytics, Customers') }}</p>
      </div>
    </div>

    <div class="module-item" data-module="finance-accounting">
      <div class="module-icon icon-purple">
        <i class="fas fa-calculator"></i>
      </div>
      <div class="module-info">
        <h6>{{ _('Finance & Accounting') }}</h6>
        <p>Billing, Invoices, Expenses</p>
      </div>
    </div>

    <div class="module-item" data-module="human-resources">
      <div class="module-icon icon-orange">
        <i class="fas fa-users"></i>
      </div>
      <div class="module-info">
        <h6>Human Resources</h6>
        <p>Employees, Payroll</p>
      </div>
    </div>

    <div class="module-item" data-module="projects-collaboration">
      <div class="module-icon icon-red">
        <i class="fas fa-project-diagram"></i>
      </div>
      <div class="module-info">
        <h6>Projects & Tasks</h6>
        <p>Management, Collaboration</p>
      </div>
    </div>

    <div class="module-item" data-module="analytics-reports">
      <div class="module-icon icon-indigo">
        <i class="fas fa-chart-bar"></i>
      </div>
      <div class="module-info">
        <h6>Analytics & Reports</h6>
        <p>Insights, Statistics</p>
      </div>
    </div>

    <div class="module-item" data-module="it-security">
      <div class="module-icon icon-pink">
        <i class="fas fa-shield-alt"></i>
      </div>
      <div class="module-info">
        <h6>Customer Relations</h6>
        <p>Support, Feedback</p>
      </div>
    </div>

    <div class="module-item" data-module="utilities">
      <div class="module-icon icon-teal">
        <i class="fas fa-warehouse"></i>
      </div>
      <div class="module-info">
        <h6>Inventory & Utils</h6>
        <p>Stock Management</p>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Welcome Section -->
    <div class="module-content active" id="welcome">
      <div class="welcome-section">
        <h1 class="welcome-title">Welcome to RahaSoft</h1>
        <p class="welcome-subtitle">Your complete business management solution built for Africa</p>
        
        <div class="stats-grid">
          <div class="stat-card">
            <span class="stat-number">{{ products|length if products else 0 }}</span>
            <span class="stat-label">Products</span>
          </div>
          <div class="stat-card">
            <span class="stat-number">{{ total_value if total_value else 0 }}</span>
            <span class="stat-label">Total Value</span>
          </div>
          <div class="stat-card">
            <span class="stat-number">{{ low_stock_count if low_stock_count else 0 }}</span>
            <span class="stat-label">Low Stock</span>
          </div>
          <div class="stat-card">
            <span class="stat-number">24/7</span>
            <span class="stat-label">Support</span>
          </div>
        </div>
      </div>

      <div class="content-header">
        <h2 class="content-title">Quick Actions</h2>
        <p class="content-subtitle">Get started with the most commonly used features</p>
      </div>

      <div class="module-cards">
        <div class="feature-card">
          <div class="feature-icon icon-green">
            <i class="fas fa-cash-register"></i>
          </div>
          <h3 class="feature-title">Point of Sale</h3>
          <p class="feature-description">Quick checkout and payment processing</p>
          <a href="{{ url_for('dashboard') }}" class="feature-button">Start Sale</a>
        </div>

        <div class="feature-card">
          <div class="feature-icon icon-blue">
            <i class="fas fa-boxes"></i>
          </div>
          <h3 class="feature-title">Inventory</h3>
          <p class="feature-description">Manage stock and product information</p>
          <a href="{{ url_for('dashboard') }}" class="feature-button">View Stock</a>
        </div>

        <div class="feature-card">
          <div class="feature-icon icon-purple">
            <i class="fas fa-chart-line"></i>
          </div>
          <h3 class="feature-title">Sales Reports</h3>
          <p class="feature-description">Analyze your business performance</p>
          <a href="{{ url_for('sales_dashboard') }}" class="feature-button">View Reports</a>
        </div>

        <div class="feature-card">
          <div class="feature-icon icon-orange">
            <i class="fas fa-plus"></i>
          </div>
          <h3 class="feature-title">Add Product</h3>
          <p class="feature-description">Add new items to your inventory</p>
          <a href="{{ url_for('dashboard') }}" class="feature-button">Add Item</a>
        </div>
      </div>
    </div>

    <!-- Core Operations Module -->
    <div class="module-content" id="core-operations">
      <div class="content-header">
        <h2 class="content-title">Core Operations</h2>
        <p class="content-subtitle">Essential business operations, inventory management, and procurement processes</p>
      </div>
      <div class="module-cards">
        {% include 'modules/core_operations.html' %}
      </div>
    </div>

    <!-- Sales & Marketing Module -->
    <div class="module-content" id="sales-marketing">
      <div class="content-header">
        <h2 class="content-title">Sales & Marketing</h2>
        <p class="content-subtitle">Drive growth with sales analytics and marketing tools</p>
      </div>
      <div class="module-cards">
        {% include 'modules/sales_marketing.html' %}
      </div>
    </div>

    <!-- Finance & Accounting Module -->
    <div class="module-content" id="finance-accounting">
      <div class="content-header">
        <h2 class="content-title">Finance & Accounting</h2>
        <p class="content-subtitle">Manage finances, billing, and accounting operations</p>
      </div>
      <div class="module-cards">
        {% include 'modules/finance.html' %}
      </div>
    </div>

    <!-- Human Resources Module -->
    <div class="module-content" id="human-resources">
      <div class="content-header">
        <h2 class="content-title">Human Resources</h2>
        <p class="content-subtitle">Employee management, payroll, and HR operations</p>
      </div>
      <div class="module-cards">
        {% include 'modules/human_resource.html' %}
      </div>
    </div>

    <!-- Projects & Collaboration Module -->
    <div class="module-content" id="projects-collaboration">
      <div class="content-header">
        <h2 class="content-title">Projects & Collaboration</h2>
        <p class="content-subtitle">Manage projects, tasks, and team collaboration</p>
      </div>
      <div class="module-cards">
        {% include 'modules/project_management.html' %}
      </div>
    </div>

    <!-- Analytics & Reports Module -->
    <div class="module-content" id="analytics-reports">
      <div class="content-header">
        <h2 class="content-title">Analytics & Reports</h2>
        <p class="content-subtitle">Business intelligence and detailed reporting</p>
      </div>
      <div class="module-cards">
        {% include 'modules/reports_analytics.html' %}
      </div>
    </div>

    <!-- Customer Relations Module -->
    <div class="module-content" id="it-security">
      <div class="content-header">
        <h2 class="content-title">Customer Relations</h2>
        <p class="content-subtitle">Customer support and relationship management</p>
      </div>
      <div class="module-cards">
        {% include 'modules/Customer_Relations.html' %}
      </div>
    </div>

    <!-- Inventory & Utilities Module -->
    <div class="module-content" id="utilities">
      <div class="content-header">
        <h2 class="content-title">Inventory & Utilities</h2>
        <p class="content-subtitle">Advanced inventory tools and utilities</p>
      </div>
      <div class="module-cards">
        {% include 'modules/inventory.html' %}
      </div>
    </div>
  </div>
</div>

<!-- Company Registration Modal -->
{% if show_company_modal %}
<div class="modal-backdrop-custom show"></div>
<div class="modal show company-modal" id="companyRegistrationModal" tabindex="-1" aria-labelledby="companyModalLabel">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title" id="companyModalLabel">
          <i class="fas fa-building me-2"></i>{{ _('Register Your Company') }}
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      
      <div class="modal-body p-4">
        <div class="alert alert-info mb-4" role="alert">
          <i class="fas fa-info-circle me-2"></i>
          {{ _('To access the ERP modules, you need to register your company first. You will become the admin of your company.') }}
        </div>

        <form method="POST" action="{{ url_for('register_company') }}" id="companyForm">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
          
          <div class="row">
            <div class="col-12 mb-3">
              <label for="name" class="form-label fw-semibold">
                <i class="fas fa-building me-2 text-primary"></i>{{ _('Company Name') }} *
              </label>
              <input type="text" class="form-control" id="name" name="name" placeholder="{{ _('Your Company Name') }}" required>
            </div>

            <div class="col-12 mb-3">
              <label for="industry" class="form-label fw-semibold">
                <i class="fas fa-industry me-2 text-primary"></i>{{ _('Industry') }}
              </label>
              <select class="form-select" id="industry" name="industry">
                <option value="">{{ _('Select Industry') }}</option>
                <option value="retail">{{ _('Retail') }}</option>
                <option value="manufacturing">{{ _('Manufacturing') }}</option>
                <option value="services">{{ _('Services') }}</option>
                <option value="technology">{{ _('Technology') }}</option>
                <option value="healthcare">{{ _('Healthcare') }}</option>
                <option value="education">{{ _('Education') }}</option>
                <option value="agriculture">{{ _('Agriculture') }}</option>
                <option value="construction">{{ _('Construction') }}</option>
                <option value="finance">{{ _('Finance') }}</option>
                <option value="hospitality">{{ _('Hospitality') }}</option>
                <option value="transportation">{{ _('Transportation') }}</option>
                <option value="other">{{ _('Other') }}</option>
              </select>
            </div>

            <div class="col-12 mb-3">
              <label for="address" class="form-label fw-semibold">
                <i class="fas fa-map-marker-alt me-2 text-primary"></i>{{ _('Company Address') }}
              </label>
              <textarea class="form-control" id="address" name="address" rows="2" placeholder="{{ _('Company address') }}"></textarea>
            </div>

            <div class="col-md-6 mb-3">
              <label for="phone" class="form-label fw-semibold">
                <i class="fas fa-phone me-2 text-primary"></i>{{ _('Phone Number') }}
              </label>
              <input type="text" class="form-control" id="phone" name="phone" placeholder="+254712345678">
            </div>

            <div class="col-md-6 mb-3">
              <label for="email" class="form-label fw-semibold">
                <i class="fas fa-envelope me-2 text-primary"></i>{{ _('Company Email') }}
              </label>
              <input type="email" class="form-control" id="email" name="email" placeholder="company@example.com">
            </div>
          </div>

          <div class="d-grid gap-2 mt-4">
            <button type="submit" class="btn btn-primary btn-lg">
              <i class="fas fa-plus-circle me-2"></i>{{ _('Register Company Now') }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
{% endif %}

<script>
  // Module switching functionality with company registration check
  document.addEventListener('DOMContentLoaded', function() {
    const moduleItems = document.querySelectorAll('.module-item');
    const moduleContents = document.querySelectorAll('.module-content');

    // Company registration check function
    async function checkCompanyStatus() {
      try {
        const response = await fetch('/check_company_status');
        const data = await response.json();
        return data;
      } catch (error) {
        console.error('Error checking company status:', error);
        return { has_company: false };
      }
    }

    moduleItems.forEach(item => {
      item.addEventListener('click', async function(e) {
        e.preventDefault();
        
        const targetModule = this.getAttribute('data-module');
        
        // Check company status before allowing module access
        const companyStatus = await checkCompanyStatus();
        
        if (!companyStatus.has_company && targetModule !== 'welcome') {
          // Show message if company modal is not already visible
          if (!document.getElementById('companyRegistrationModal')) {
            alert('{{ _("Please register your company first to access modules.") }}');
          }
          return;
        }
        
        // Proceed with normal module switching if company is registered
        // Remove active class from all items and contents
        moduleItems.forEach(i => i.classList.remove('active'));
        moduleContents.forEach(c => c.classList.remove('active'));
        
        // Add active class to clicked item and corresponding content
        this.classList.add('active');
        const targetContent = document.getElementById(targetModule);
        if (targetContent) {
          targetContent.classList.add('active');
        }
      });
    });

    // Initialize first module based on company status
    checkCompanyStatus().then(status => {
      if (status.has_company && moduleItems.length > 0) {
        // If user has company, activate first module
        moduleItems[0].click();
      } else {
        // If no company, just show welcome module
        const welcomeModule = document.querySelector('[data-module="welcome"]');
        if (welcomeModule) {
          welcomeModule.click();
        }
      }
    });

    // Handle company form submission
    const companyForm = document.getElementById('companyForm');
    if (companyForm) {
      companyForm.addEventListener('submit', function(e) {
        const nameField = document.getElementById('name');
        if (!nameField.value.trim()) {
          e.preventDefault();
          alert('{{ _("Company name is required") }}');
          nameField.focus();
          return false;
        }
      });
    }

    // Ensure company modal is visible if flag is set
    const companyModal = document.getElementById('companyRegistrationModal');
    if (companyModal) {
      // Make sure modal is visible
      companyModal.style.display = 'block';
      companyModal.classList.add('show');
      
      // Focus on first input
      const firstInput = companyModal.querySelector('input[name="name"]');
      if (firstInput) {
        setTimeout(() => firstInput.focus(), 300);
      }
    }
  });
</script>

<style>
.bg-gradient {
  background: var(--gradient-primary);
}

.modal-content {
  border-radius: 15px;
  overflow: hidden;
  border: none;
  box-shadow: var(--shadow-lg);
}

.btn-primary {
  background: var(--gradient-primary);
  border: none;
  font-weight: 600;
  transition: all 0.3s ease;
}

  .btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
  }

  /* Company Registration Modal Styles */
  .modal-backdrop-custom {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    z-index: 1040;
    display: block;
  }

  .company-modal {
    z-index: 1050;
    display: block !important;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
  }

  .company-modal .modal-content {
    border-radius: 15px;
    border: none;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
    animation: modalSlideIn 0.3s ease-out;
  }

  .company-modal .modal-header {
    border-bottom: none;
    border-radius: 15px 15px 0 0;
  }

  .company-modal .form-control:focus,
  .company-modal .form-select:focus {
    border-color: var(--primary-color);
    box-shadow: 0 0 0 0.2rem rgba(59, 130, 246, 0.25);
  }

  @keyframes modalSlideIn {
    from {
      opacity: 0;
      transform: scale(0.8) translateY(-50px);
    }
    to {
      opacity: 1;
      transform: scale(1) translateY(0);
    }
  }

  .company-modal .alert-info {
    background: rgba(59, 130, 246, 0.1);
    border: 1px solid rgba(59, 130, 246, 0.2);
    color: var(--text-primary);
  }
</style>{% endblock %}
